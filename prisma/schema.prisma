generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator json {
  provider = "prisma-json-types-generator"
}

generator prismabox {
  provider                    = "prismabox"
  typeboxImportDependencyName = "elysia"
  typeboxImportVariableName   = "t"
  inputModel                  = true
}

model User {
  id        String  @id @default(uuid())
  name      String
  email     String  @unique
  password  String
  avatarUrl String?

  role UserRole @default(User)

  organization   Organization? @relation(fields: [organizationId], references: [id])
  organizationId String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum UserRole {
  Admin
  User
}

model Organization {
  id String @id @default(uuid())

  /// [LocalString]
  name        Json
  /// [LocalString]
  description Json?
  phoneNumber String?
  email       String?

  googleMapsLink String?
  /// [SocialMediaLink]
  socialMedia    Json[]

  slug       String  @unique
  logoImgUrl String?

  users      User[]
  categories Category[]
  items      Item[]

  /// [menuStructure]
  menuStructure Json[]

  medias Media[]
  
  subscription Subscription?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Subscription {
  id String @id @default(uuid())
  
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  organizationId String @unique
  
  plan   Plan @relation(fields: [planId], references: [id])
  planId String
  
  status SubscriptionStatus @default(Inactive)
  endsAt DateTime?
  
  payments Payment[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum SubscriptionStatus {
  Active
  Inactive
  Trial
  Expired
}

model Category {
  id       String  @id @default(uuid())
  slug     String  @unique
  /// [LocalString]
  name     Json
  imageUrl String?

  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  organizationId String

  items Item[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Item {
  id   String @id @default(uuid())
  slug String @unique

  /// [LocalString]
  name        Json
  /// [LocalString]
  description Json?

  imageUrl  String[]
  basePrice String

  /// [ItemVariantGroup]
  variantGroups Json?

  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  organizationId String

  category   Category? @relation(fields: [categoryId], references: [id])
  categoryId String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Media {
  id           String    @id @default(uuid())
  url          String
  key          String    @unique
  name         String
  size         Int
  originalSize Int
  originalName String
  type         MediaType
  entityId     String

  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  organizationId String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum MediaType {
  categoryImage
  itemImage
  orgLogo
  avatarImage
}

model Plan {
  id String @id @default(uuid())

  /// [LocalString]
  name        Json
  /// [LocalString]
  description Json?

  price Int @default(0)

  durationInDays Int @default(30)

  maxCategories Int @default(10)
  maxItems      Int @default(50)
  maxStaff      Int @default(5)
  maxMedia      Int @default(100)

  isActive Boolean @default(true)

  subscriptions Subscription[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Payment {
  id     String  @id @default(uuid())
  
  amount Int
  paidAt DateTime @default(now())
  
  periodStart DateTime
  periodEnd   DateTime
  
  notes    String?
  imageUrl String?
  
  waylReferenceId String? @unique
  waylLinkId      String? @unique
  waylStatus      String?
  isPaid          Boolean @default(false)
  
  subscription   Subscription @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)
  subscriptionId String
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}